COMPILE;
DIRECTORY MASTER;
/****************************************************************************
lfu
19/10/88

Blitter data logic function unit

This unit selects the data to be output during a write cycle.  This may be
taken from the source data, the destination data, or the pattern data.  In
sixteen bit mode the high byte is always the source data.

****************************************************************************/


MODULE LFU;

INPUTS	D_0,D_1,D_2,D_3,D_4,D_5,D_6,D_7,D_8,D_9,D_10,D_11,D_12,D_13,D_14,D_15,
   DAM1L,DATOEL,DSTD_0,DSTD_1,DSTD_2,DSTD_3,DSTD_4,DSTD_5,DSTD_6,DSTD_7,ID_4,
   ID_5,ID_6,ID_7,LDCMPL,LDMODL,PATD_0,PATD_1,PATD_2,PATD_3,PATD_4,PATD_5,
   PATD_6,PATD_7,RES_0,SRCD_0,SRCD_1,SRCD_2,SRCD_3,SRCD_4,SRCD_5,SRCD_6,SRCD_7,
   SRCD_8,SRCD_9,SRCD_10,SRCD_11,SRCD_12,SRCD_13,SRCD_14,SRCD_15;
OUTPUTS	D_0,D_1,D_2,D_3,D_4,D_5,D_6,D_7,D_8,D_9,D_10,D_11,D_12,D_13,D_14,D_15;
LEVEL FUNCTION;
DEFINE

RESL_0_(RESL_0) = N1A(RES_0);

/* LFU Control bits */

LFUCL_0_(LFUC_0,LFUCL_0) = LD2A(ID_4,LDCMPL);
LFUCL_1_(LFUC_1,LFUCL_1) = LD2A(ID_5,LDCMPL);
LFUCL_2_(LFUC_2,LFUCL_2) = LD2A(ID_6,LDCMPL);
LFUCL_3_(LFUC_3,LFUCL_3) = LD2A(ID_7,LDCMPL);
PATSEL_(PATSEL,PATSELL) = LD2A(ID_7,LDMODL);

/* Select between pattern data and source data */

PSMUX_0_(PSD_0) = MUX2(SRCD_0,PATSELL,PATD_0,PATSEL);
PSMUX_1_(PSD_1) = MUX2(SRCD_1,PATSELL,PATD_1,PATSEL);
PSMUX_2_(PSD_2) = MUX2(SRCD_2,PATSELL,PATD_2,PATSEL);
PSMUX_3_(PSD_3) = MUX2(SRCD_3,PATSELL,PATD_3,PATSEL);
PSMUX_4_(PSD_4) = MUX2(SRCD_4,PATSELL,PATD_4,PATSEL);
PSMUX_5_(PSD_5) = MUX2(SRCD_5,PATSELL,PATD_5,PATSEL);
PSMUX_6_(PSD_6) = MUX2(SRCD_6,PATSELL,PATD_6,PATSEL);
PSMUX_7_(PSD_7) = MUX2(SRCD_7,PATSELL,PATD_7,PATSEL);

/* Logic Function Unit */

LFU_0_(FD_0) = LFUBIT(PSD_0,DSTD_0,LFUC_0,LFUC_1,LFUC_2,LFUC_3);
LFU_1_(FD_1) = LFUBIT(PSD_1,DSTD_1,LFUC_0,LFUC_1,LFUC_2,LFUC_3);
LFU_2_(FD_2) = LFUBIT(PSD_2,DSTD_2,LFUC_0,LFUC_1,LFUC_2,LFUC_3);
LFU_3_(FD_3) = LFUBIT(PSD_3,DSTD_3,LFUC_0,LFUC_1,LFUC_2,LFUC_3);
LFU_4_(FD_4) = LFUBIT(PSD_4,DSTD_4,LFUC_0,LFUC_1,LFUC_2,LFUC_3);
LFU_5_(FD_5) = LFUBIT(PSD_5,DSTD_5,LFUC_0,LFUC_1,LFUC_2,LFUC_3);
LFU_6_(FD_6) = LFUBIT(PSD_6,DSTD_6,LFUC_0,LFUC_1,LFUC_2,LFUC_3);
LFU_7_(FD_7) = LFUBIT(PSD_7,DSTD_7,LFUC_0,LFUC_1,LFUC_2,LFUC_3);

/* Select LFU output or unchanged destination data for hires or lores */

HRHDINV_(LODSEL,HIDSELL) = MACINV2(LODSELL,HIDSEL);
DAM1_(DAM1) = N1A(DAM1L);
LODGEN_(LODSELL) = ND2A(RESL_0,DAM1);
HIDGEN_(HIDSEL) = NR2A(RES_0,DAM1);
LFDOMUX_0_(FDOL_0) = AO2A(LODSEL,DSTD_0,LODSELL,FD_0);
LFDOMUX_1_(FDOL_1) = AO2A(LODSEL,DSTD_1,LODSELL,FD_1);
LFDOMUX_2_(FDOL_2) = AO2A(LODSEL,DSTD_2,LODSELL,FD_2);
LFDOMUX_3_(FDOL_3) = AO2A(LODSEL,DSTD_3,LODSELL,FD_3);
LFDOMUX_4_(FDOL_4) = AO2A(HIDSEL,DSTD_4,HIDSELL,FD_4);
LFDOMUX_5_(FDOL_5) = AO2A(HIDSEL,DSTD_5,HIDSELL,FD_5);
LFDOMUX_6_(FDOL_6) = AO2A(HIDSEL,DSTD_6,HIDSELL,FD_6);
LFDOMUX_7_(FDOL_7) = AO2A(HIDSEL,DSTD_7,HIDSELL,FD_7);

/* Drive the output data onto the data bus */

DATOE_(DATOE) = N1C(DATOEL);
LFDRIV_0_(D_0) = BTS5A(FDOL_0,DATOE);
LFDRIV_1_(D_1) = BTS5A(FDOL_1,DATOE);
LFDRIV_2_(D_2) = BTS5A(FDOL_2,DATOE);
LFDRIV_3_(D_3) = BTS5A(FDOL_3,DATOE);
LFDRIV_4_(D_4) = BTS5A(FDOL_4,DATOE);
LFDRIV_5_(D_5) = BTS5A(FDOL_5,DATOE);
LFDRIV_6_(D_6) = BTS5A(FDOL_6,DATOE);
LFDRIV_7_(D_7) = BTS5A(FDOL_7,DATOE);
LFDRIV_8_(D_8) = BTS4A(SRCD_8,DATOE);
LFDRIV_9_(D_9) = BTS4A(SRCD_9,DATOE);
LFDRIV_10_(D_10) = BTS4A(SRCD_10,DATOE);
LFDRIV_11_(D_11) = BTS4A(SRCD_11,DATOE);
LFDRIV_12_(D_12) = BTS4A(SRCD_12,DATOE);
LFDRIV_13_(D_13) = BTS4A(SRCD_13,DATOE);
LFDRIV_14_(D_14) = BTS4A(SRCD_14,DATOE);
LFDRIV_15_(D_15) = BTS4A(SRCD_15,DATOE);

END MODULE;

/* Logic function unit element */

MODULE LFUBIT;

INPUTS	SRCD,DSTD,LFUC_0,LFUC_1,LFUC_2,LFUC_3;
OUTPUTS	DOUT;
LEVEL FUNCTION;
DEFINE

DINV_(SRCDL,DSTDL) = MACINV2(SRCD,DSTD);
LFTRM0_(TRM_0) = ND3A(SRCDL,DSTDL,LFUC_0);
LFTRM1_(TRM_1) = ND3A(SRCDL,DSTD,LFUC_1);
LFTRM2_(TRM_2) = ND3A(SRCD,DSTDL,LFUC_2);
LFTRM3_(TRM_3) = ND3A(SRCD,DSTD,LFUC_3);
LFGEN_(DOUT) = ND4A(TRM_0,TRM_1,TRM_2,TRM_3);

END MODULE;
END COMPILE;
END;
